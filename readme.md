# AstrBot 个人记忆插件（精美图片回复版）

## 🎯 功能亮点

- **个人专属记忆空间**：每个QQ用户拥有独立的记忆存储
- **精美图片回复**：所有记忆内容以精美的卡片图片形式展示
- **群聊记忆隔离**：群聊中各用户记忆完全隔离，互不干扰
- **智能标签系统**：支持#标签分类记忆
- **使用频率统计**：记录每条记忆的使用次数
- **数据持久化**：记忆数据永久保存，支持备份迁移
- **多场景支持**：同时支持私聊和群聊场景

## 🎨 图片展示效果

### 记忆卡片样式
- **渐变背景**：优雅的蓝紫色渐变背景
- **圆角设计**：现代化的圆角卡片设计
- **图标装饰**：智能的🧠大脑和📖书籍图标
- **标签展示**：彩色标签显示分类信息
- **时间戳**：精确的时间记录
- **用户信息**：显示用户昵称和时间

### 列表展示样式
- **卡片式布局**：每条记忆以卡片形式展示
- **分隔线**：清晰的分隔线区分不同记忆
- **使用计数**：显示每条记忆的使用频率
- **内容预览**：智能截取显示记忆内容

## 📋 命令列表

| 命令 | 功能 | 示例 |
|------|------|------|
| `记住 [关键词] [内容]` | 添加个人记忆 | `记住 生日 1990年1月1日 #重要` |
| `回忆 [关键词]` | 查看指定记忆 | `回忆 生日` |
| `搜索记忆 [关键词]` | 搜索相关记忆 | `搜索记忆 生日` |
| `我的记忆` | 查看所有记忆 | `我的记忆` |
| `删除记忆 [关键词]` | 删除指定记忆 | `删除记忆 生日` |
| `我的记忆统计` | 查看使用统计 | `我的记忆统计` |

## 🚀 快速开始

### 安装步骤

1. **安装依赖**
   ```bash
   pip install Pillow
   ```

2. **安装插件**
   - 将 `memory_plugin.py` 文件复制到 AstrBot 的 `plugins/` 目录
   - 重启 AstrBot 服务

3. **验证安装**
   - 在聊天中输入：`我的记忆`
   - 如果看到提示"您还没有任何记忆"，说明安装成功

### 使用示例

#### 添加记忆
```
用户：记住 我的生日 1990年1月1日 #重要 #生日
机器人：[精美图片卡片]
显示：记忆记住成功
关键词：我的生日
内容：1990年1月1日
标签：#重要 #生日
```

#### 查看记忆
```
用户：回忆 我的生日
机器人：[精美图片卡片]
显示：记忆回忆成功
关键词：我的生日
内容：1990年1月1日
标签：#重要 #生日
```

#### 搜索记忆
```
用户：搜索记忆 生日
机器人：[记忆列表图片]
显示：找到1条相关记忆
- 我的生日 (使用1次)
```

## 🏗️ 技术架构

### 数据存储
```json
{
  "user_qq_123456": {
    "我的生日": {
      "content": "1990年1月1日",
      "tags": ["重要", "生日"],
      "created_at": "2024-01-15T10:30:00",
      "usage_count": 5
    }
  },
  "user_qq_789012": {
    "工作邮箱": {
      "content": "work@example.com",
      "tags": ["工作", "邮箱"],
      "created_at": "2024-01-15T11:00:00",
      "usage_count": 2
    }
  }
}
```

### 文件结构
```
AstrBot/
├── plugins/
│   └── memory_plugin.py    # 主插件文件
├── data/
│   └── personal_memory.json # 记忆数据文件
└── requirements.txt        # 依赖列表
```

## 🎨 图片生成特性

### 设计特色
- **响应式布局**：根据内容长度自动调整图片高度
- **品牌色彩**：使用AstrBot品牌色系
- **现代化UI**：圆角、阴影、渐变等现代设计元素
- **易读性优化**：合理的字体大小和行间距

### 兼容性
- **格式支持**：PNG格式，高质量输出
- **尺寸优化**：800px宽度，适配各种屏幕
- **文件大小**：压缩优化，加载快速
- **平台兼容**：支持QQ、微信、Telegram等平台

## 🔧 高级配置

### 自定义样式
可以通过修改 `MemoryImageGenerator` 类来自定义图片样式：

```python
# 修改卡片尺寸
self.width = 1000  # 更宽的卡片
self.height = 800  # 更高的卡片

# 修改颜色方案
background_color = '#f0f9ff'  # 天蓝色背景
accent_color = '#0ea5e9'    # 天蓝色主题
```

### 性能优化
- **缓存机制**：重复生成的图片会被缓存
- **异步处理**：图片生成不会阻塞主线程
- **内存管理**：及时清理临时图片数据

## 📊 使用统计

插件会自动记录以下统计数据：
- 记忆添加次数
- 记忆使用频率
- 用户活跃统计
- 标签使用统计

## 🔍 故障排除

### 常见问题

#### 图片无法显示
- **问题**：机器人回复空白或显示错误
- **解决**：检查是否安装了Pillow库
  ```bash
  pip install Pillow
  ```

#### 记忆丢失
- **问题**：重启后记忆消失
- **解决**：检查 `data/personal_memory.json` 文件是否存在
- **备份**：手动备份该文件到其他位置

#### 权限问题
- **问题**：无法保存记忆
- **解决**：确保AstrBot有读写 `data/` 目录的权限

### 调试模式
在 `memory_plugin.py` 中设置调试开关：
```python
DEBUG = True  # 开启调试日志
```

## 🔄 版本更新

### v3.0.0 (当前版本)
- ✨ 新增精美图片回复功能
- 🎨 优化视觉展示效果
- 📱 支持移动端适配
- 🔧 改进错误处理机制

### v2.0.0
- 🎯 支持按QQ账号隔离记忆
- 🏗️ 重构数据存储结构
- 📊 添加使用统计功能

### v1.0.0
- 📝 基础记忆功能
- 🔍 简单搜索功能
- 💾 数据持久化

## 🤝 贡献指南

欢迎提交Issue和Pull Request来改进这个插件！

### 开发环境
```bash
git clone [仓库地址]
cd astrbot-memory-plugin
pip install -r requirements.txt
python test_personal_memory.py
```

### 测试用例
运行测试脚本验证功能：
```bash
python test_personal_memory.py
```

## 📄 许可证

MIT License - 详见 LICENSE 文件

## 🙋‍♂️ 联系我

- **GitHub**：提交Issue
- **邮件**：1958014593@qq.com

---

**享受您的精美记忆体验！** 🎉